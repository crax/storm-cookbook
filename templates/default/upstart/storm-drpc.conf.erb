# This file is managed by Chef any changes made will be overwritten

# What user and group to run as
setuid root
setgid root

limit nofile 32768 32768

start on (local-filesystems and net-device-up IFACE=eth0)
stop on [!12345]
respawn

script
    # General storm parameters
<%= render "env/storm.erb", :variables => { :user => @user, :storm_home => @storm_home, :java_lib_path => @java_lib_path } %>
    # DRPC parameters
    STORM_DRPC_PID="<%= @drpc_pid %>"
    STORM_DRPC_JVM_MEMORY="<%= @drpc_mem %>"
    STORM_DRPC_JVM_OPTS="-Dlog4j.configuration=file:/etc/storm/storm.log.properties -Dlogfile.name=drpc.log"

    # Set STORM Options
    STORM_CMD="-classpath $STORM_CLASSPATH -Xms$STORM_DRPC_JVM_MEMORY -Xmx$STORM_DRPC_JVM_MEMORY -Djava.library.path=\"$JAVA_LIBRARY_PATH\" -Dstorm.options=\"$STORM_OPTIONS\" -Dstorm.home=$STORM_HOME $STORM_DRPC_JVM_OPTS backtype.storm.daemon.drpc"

    exec start-stop-daemon --start --pidfile ${STORM_DRPC_PID} --make-pidfile --chuid ${STORM_USER} --chdir ${STORM_HOME} --exec /usr/bin/java -- ${STORM_CMD}

end script
